---
import BaseLayout from '../layouts/BaseLayout.astro'

const images = [
  { src: '/images/DSCF6576.JPG', alt: '风景', category: '风景' },
  { src: '/images/DSC_0280.JPG', alt: '风景', category: '风景' },
  { src: '/images/IMG_20190914_081951.jpg', alt: '旅行', category: '旅行' },
  { src: '/images/IMG_3960.jpeg', alt: '生活', category: '生活' },
  { src: '/images/B612Kaji_20191010_195845_809.jpg', alt: '人物', category: '人物' },
  { src: '/images/408301ab95d416219de0b297ceff9b0f.jpeg', alt: '生活', category: '生活' },
  { src: '/images/7ff2f498da9fcb693ff26f176a0806c2.jpg', alt: '生活', category: '生活' },
  { src: '/images/f4bec887b203ff0861f33bb95be90dd8.jpg', alt: '生活', category: '生活' },
]

const categories = ['全部', ...new Set(images.map(img => img.category).filter(Boolean))]
---

<BaseLayout title="相册">
  <div class="space-y-8 animate-fade-in">
    <header class="space-y-4">
      <h1 class="text-3xl font-bold" data-zh="相册" data-en="Gallery">相册</h1>
      <p class="text-gray-600 dark:text-gray-400" data-zh="记录生活中的美好瞬间" data-en="Capturing beautiful moments in life">
        记录生活中的美好瞬间
      </p>
    </header>

    <!-- Category Filter -->
    <div class="flex flex-wrap gap-2">
      {categories.map((cat, index) => (
        <button
          class:list={[
            'category-btn px-4 py-2 text-sm rounded-full transition-all duration-300',
            index === 0
              ? 'bg-gray-900 dark:bg-white text-white dark:text-gray-900 active'
              : 'bg-gray-100 dark:bg-gray-800 text-gray-600 dark:text-gray-400 hover:bg-gray-200 dark:hover:bg-gray-700'
          ]}
          data-category={cat}
        >
          {cat}
        </button>
      ))}
    </div>

    <!-- Masonry Gallery -->
    <div class="columns-2 md:columns-3 gap-4 space-y-4" id="gallery">
      {images.map((image, index) => (
        <div
          class="gallery-item break-inside-avoid group cursor-pointer"
          data-category={image.category}
        >
          <div class="relative overflow-hidden rounded-xl bg-gray-100 dark:bg-gray-800">
            <img
              src={image.src}
              alt={image.alt}
              class="w-full object-cover transition-all duration-500 group-hover:scale-105"
              loading="lazy"
            />
            <div class="absolute inset-0 bg-black/0 group-hover:bg-black/20 transition-all duration-300"></div>
            <div class="absolute bottom-0 left-0 right-0 p-4 bg-gradient-to-t from-black/60 to-transparent opacity-0 group-hover:opacity-100 transition-all duration-300">
              <span class="text-white text-sm">{image.category}</span>
            </div>
          </div>
        </div>
      ))}
    </div>

    <!-- Lightbox -->
    <div id="lightbox" class="fixed inset-0 bg-black/90 z-50 hidden items-center justify-center p-4">
      <button id="lightbox-close" class="absolute top-4 right-4 text-white/80 hover:text-white transition-colors">
        <svg class="w-8 h-8" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
        </svg>
      </button>
      <button id="lightbox-prev" class="absolute left-4 text-white/80 hover:text-white transition-colors">
        <svg class="w-10 h-10" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
        </svg>
      </button>
      <img id="lightbox-img" src="" alt="" class="max-w-full max-h-[90vh] object-contain" />
      <button id="lightbox-next" class="absolute right-4 text-white/80 hover:text-white transition-colors">
        <svg class="w-10 h-10" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
        </svg>
      </button>
    </div>
  </div>
</BaseLayout>

<script>
  // Category filter
  const categoryBtns = document.querySelectorAll('.category-btn')
  const galleryItems = document.querySelectorAll('.gallery-item')

  categoryBtns.forEach(btn => {
    btn.addEventListener('click', () => {
      const category = btn.getAttribute('data-category')

      // Update active button
      categoryBtns.forEach(b => {
        b.classList.remove('bg-gray-900', 'dark:bg-white', 'text-white', 'dark:text-gray-900', 'active')
        b.classList.add('bg-gray-100', 'dark:bg-gray-800', 'text-gray-600', 'dark:text-gray-400')
      })
      btn.classList.remove('bg-gray-100', 'dark:bg-gray-800', 'text-gray-600', 'dark:text-gray-400')
      btn.classList.add('bg-gray-900', 'dark:bg-white', 'text-white', 'dark:text-gray-900', 'active')

      // Filter images
      galleryItems.forEach(item => {
        const itemCategory = item.getAttribute('data-category')
        if (category === '全部' || itemCategory === category) {
          item.style.display = ''
        } else {
          item.style.display = 'none'
        }
      })
    })
  })

  // Lightbox
  const lightbox = document.getElementById('lightbox')
  const lightboxImg = document.getElementById('lightbox-img') as HTMLImageElement
  const lightboxClose = document.getElementById('lightbox-close')
  const lightboxPrev = document.getElementById('lightbox-prev')
  const lightboxNext = document.getElementById('lightbox-next')

  let currentIndex = 0
  const images = Array.from(galleryItems).map(item => item.querySelector('img')?.src || '')

  galleryItems.forEach((item, index) => {
    item.addEventListener('click', () => {
      currentIndex = index
      lightboxImg.src = images[currentIndex]
      lightbox?.classList.remove('hidden')
      lightbox?.classList.add('flex')
      document.body.style.overflow = 'hidden'
    })
  })

  const closeLightbox = () => {
    lightbox?.classList.add('hidden')
    lightbox?.classList.remove('flex')
    document.body.style.overflow = ''
  }

  lightboxClose?.addEventListener('click', closeLightbox)
  lightbox?.addEventListener('click', (e) => {
    if (e.target === lightbox) closeLightbox()
  })

  lightboxPrev?.addEventListener('click', (e) => {
    e.stopPropagation()
    currentIndex = (currentIndex - 1 + images.length) % images.length
    lightboxImg.src = images[currentIndex]
  })

  lightboxNext?.addEventListener('click', (e) => {
    e.stopPropagation()
    currentIndex = (currentIndex + 1) % images.length
    lightboxImg.src = images[currentIndex]
  })

  // Keyboard navigation
  document.addEventListener('keydown', (e) => {
    if (lightbox?.classList.contains('hidden')) return
    if (e.key === 'Escape') closeLightbox()
    if (e.key === 'ArrowLeft') lightboxPrev?.click()
    if (e.key === 'ArrowRight') lightboxNext?.click()
  })
</script>
